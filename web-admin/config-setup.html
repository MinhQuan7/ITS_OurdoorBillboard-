<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Banner Management - Demo Configuration</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        min-height: 100vh;
      }
      .config-container {
        max-width: 800px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 30px;
      }
      .config-section {
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      h1,
      h2 {
        margin-bottom: 20px;
      }
      .config-field {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }
      input,
      select {
        width: 100%;
        padding: 10px 15px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 14px;
      }
      input::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }
      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        margin-right: 10px;
        margin-bottom: 10px;
      }
      .btn.primary {
        background: linear-gradient(135deg, #4ade80, #22c55e);
        color: white;
      }
      .btn.secondary {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      .status-box {
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        font-size: 14px;
      }
      .status-box.success {
        background: rgba(74, 222, 128, 0.2);
        border: 1px solid rgba(74, 222, 128, 0.3);
      }
      .status-box.error {
        background: rgba(248, 113, 113, 0.2);
        border: 1px solid rgba(248, 113, 113, 0.3);
      }
      .status-box.info {
        background: rgba(59, 130, 246, 0.2);
        border: 1px solid rgba(59, 130, 246, 0.3);
      }
      pre {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 8px;
        overflow-x: auto;
        font-size: 12px;
        margin-top: 10px;
      }
      .demo-links {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <div class="config-container">
      <header>
        <h1>üõ†Ô∏è Banner Management System - Configuration</h1>
        <p>Configure your E-Ra IoT Platform settings for banner management</p>
      </header>

      <!-- E-Ra Configuration -->
      <section class="config-section">
        <h2>üîß E-Ra Platform Configuration</h2>

        <div class="config-field">
          <label for="authToken">AUTH_TOKEN *</label>
          <input
            type="text"
            id="authToken"
            placeholder="Token your-era-auth-token-here"
            required
          />
        </div>

        <div class="config-field">
          <label for="deviceId">DEVICE_ID *</label>
          <input
            type="text"
            id="deviceId"
            placeholder="your-device-id-here"
            required
          />
        </div>

        <div class="config-field">
          <label for="baseUrl">API Base URL</label>
          <input
            type="url"
            id="baseUrl"
            value="https://backend.eoh.io"
            required
          />
        </div>

        <div class="config-field">
          <label for="mqttApiKey">MQTT API Key</label>
          <input
            type="text"
            id="mqttApiKey"
            placeholder="your-mqtt-api-key (optional)"
          />
        </div>

        <button class="btn primary" onclick="testConnection()">
          Test Connection
        </button>
        <button class="btn secondary" onclick="saveConfig()">
          Save Configuration
        </button>

        <div id="connectionStatus"></div>
      </section>

      <!-- Variable Configuration -->
      <section class="config-section">
        <h2>üìä E-Ra Variables Configuration</h2>
        <p>Make sure these variables exist in your E-Ra platform:</p>

        <div class="config-field">
          <label for="bannerData">Banner Data Variable</label>
          <input type="text" id="bannerData" value="banner_data" />
        </div>

        <div class="config-field">
          <label for="bannerFilename">Banner Filename Variable</label>
          <input type="text" id="bannerFilename" value="banner_filename" />
        </div>

        <div class="config-field">
          <label for="bannerTimestamp">Banner Timestamp Variable</label>
          <input type="text" id="bannerTimestamp" value="banner_timestamp" />
        </div>

        <div class="config-field">
          <label for="bannerStatus">Banner Status Variable</label>
          <input type="text" id="bannerStatus" value="banner_status" />
        </div>

        <button class="btn primary" onclick="generateVariables()">
          Generate E-Ra Variables
        </button>
        <button class="btn secondary" onclick="checkVariables()">
          Check Variables
        </button>

        <div id="variableStatus"></div>
      </section>

      <!-- Generated Configuration -->
      <section class="config-section">
        <h2>üìÑ Generated Configuration</h2>
        <p>Copy this configuration to your files:</p>

        <h3>For Web Admin (era-config.js):</h3>
        <pre id="webConfig"></pre>

        <h3>For Desktop App (TypeScript):</h3>
        <pre id="desktopConfig"></pre>

        <button class="btn secondary" onclick="copyWebConfig()">
          Copy Web Config
        </button>
        <button class="btn secondary" onclick="copyDesktopConfig()">
          Copy Desktop Config
        </button>
      </section>

      <!-- Demo Links -->
      <section class="config-section">
        <h2>üöÄ Demo & Testing</h2>
        <div class="demo-links">
          <button class="btn primary" onclick="openBannerManager()">
            Open Banner Manager
          </button>
          <button class="btn secondary" onclick="generateSampleImage()">
            Generate Sample Banner
          </button>
          <button class="btn secondary" onclick="testMqttConnection()">
            Test MQTT
          </button>
        </div>

        <div id="demoStatus"></div>
      </section>
    </div>

    <script>
      // Configuration state
      let config = {
        authToken: "",
        deviceId: "",
        baseUrl: "https://backend.eoh.io",
        mqttApiKey: "",
        variables: {
          bannerData: "banner_data",
          bannerFilename: "banner_filename",
          bannerTimestamp: "banner_timestamp",
          bannerStatus: "banner_status",
        },
      };

      // Load saved configuration
      function loadConfig() {
        const saved = localStorage.getItem("banner_config");
        if (saved) {
          config = { ...config, ...JSON.parse(saved) };
          updateUI();
        }
      }

      // Update UI with current config
      function updateUI() {
        document.getElementById("authToken").value = config.authToken;
        document.getElementById("deviceId").value = config.deviceId;
        document.getElementById("baseUrl").value = config.baseUrl;
        document.getElementById("mqttApiKey").value = config.mqttApiKey;
        document.getElementById("bannerData").value =
          config.variables.bannerData;
        document.getElementById("bannerFilename").value =
          config.variables.bannerFilename;
        document.getElementById("bannerTimestamp").value =
          config.variables.bannerTimestamp;
        document.getElementById("bannerStatus").value =
          config.variables.bannerStatus;

        generateConfigurations();
      }

      // Save configuration
      function saveConfig() {
        config.authToken = document.getElementById("authToken").value;
        config.deviceId = document.getElementById("deviceId").value;
        config.baseUrl = document.getElementById("baseUrl").value;
        config.mqttApiKey = document.getElementById("mqttApiKey").value;
        config.variables.bannerData =
          document.getElementById("bannerData").value;
        config.variables.bannerFilename =
          document.getElementById("bannerFilename").value;
        config.variables.bannerTimestamp =
          document.getElementById("bannerTimestamp").value;
        config.variables.bannerStatus =
          document.getElementById("bannerStatus").value;

        localStorage.setItem("banner_config", JSON.stringify(config));
        generateConfigurations();

        showStatus(
          "connectionStatus",
          "Configuration saved successfully!",
          "success"
        );
      }

      // Generate configuration files
      function generateConfigurations() {
        // Web admin config
        const webConfig = `const ERA_CONFIG = {
    AUTH_TOKEN: '${config.authToken}',
    DEVICE_ID: '${config.deviceId}',
    API_BASE_URL: '${config.baseUrl}/api/v1',
    MQTT_BROKER: 'mqtt://${new URL(config.baseUrl).hostname}:1883',
    MQTT_PORT: 1883,
    
    VARIABLES: {
        BANNER_DATA: '${config.variables.bannerData}',
        BANNER_FILENAME: '${config.variables.bannerFilename}', 
        BANNER_TIMESTAMP: '${config.variables.bannerTimestamp}',
        BANNER_STATUS: '${config.variables.bannerStatus}'
    }
};`;

        // Desktop app config
        const desktopConfig = `const bannerConfig: BannerConfig = {
    enabled: true,
    authToken: '${config.authToken}',
    baseUrl: '${config.baseUrl}',
    mqttApiKey: '${config.mqttApiKey}',
    variables: {
        bannerData: '${config.variables.bannerData}',
        bannerFilename: '${config.variables.bannerFilename}',
        bannerTimestamp: '${config.variables.bannerTimestamp}',
        bannerStatus: '${config.variables.bannerStatus}'
    },
    timeout: 10000,
    retryAttempts: 3,
    retryDelay: 5000
};`;

        document.getElementById("webConfig").textContent = webConfig;
        document.getElementById("desktopConfig").textContent = desktopConfig;
      }

      // Test E-Ra connection
      async function testConnection() {
        if (!config.authToken || !config.deviceId) {
          showStatus(
            "connectionStatus",
            "Please enter AUTH_TOKEN and DEVICE_ID first",
            "error"
          );
          return;
        }

        showStatus("connectionStatus", "Testing connection...", "info");

        try {
          // Simulate API test (replace with actual E-Ra API call)
          const response = await fetch(
            `${config.baseUrl}/api/v1/devices/${config.deviceId}`,
            {
              method: "GET",
              headers: {
                Authorization: config.authToken,
                "Content-Type": "application/json",
              },
            }
          );

          if (response.ok) {
            showStatus(
              "connectionStatus",
              "Connection successful! ‚úÖ",
              "success"
            );
          } else {
            showStatus(
              "connectionStatus",
              `Connection failed: HTTP ${response.status}`,
              "error"
            );
          }
        } catch (error) {
          showStatus(
            "connectionStatus",
            `Connection failed: ${error.message}`,
            "error"
          );
        }
      }

      // Generate E-Ra variables
      function generateVariables() {
        const variablesList = Object.values(config.variables)
          .map((name) => `- ${name} (String/Number)`)
          .join("\n");

        const instructions = `
Create these variables in your E-Ra Platform:

${variablesList}

Instructions:
1. Login to E-Ra Dashboard
2. Go to your device/gateway settings  
3. Create new variables with the names above
4. Set appropriate data types (String for images, Number for timestamps)
5. Save and activate variables
`;

        showStatus("variableStatus", instructions, "info");
      }

      // Check variables exist
      async function checkVariables() {
        showStatus("variableStatus", "Checking variables...", "info");

        // Simulate variable check
        setTimeout(() => {
          showStatus(
            "variableStatus",
            "Variable check completed. Please verify manually in E-Ra dashboard.",
            "success"
          );
        }, 1000);
      }

      // Copy configurations
      function copyWebConfig() {
        navigator.clipboard.writeText(
          document.getElementById("webConfig").textContent
        );
        showStatus(
          "connectionStatus",
          "Web config copied to clipboard!",
          "success"
        );
      }

      function copyDesktopConfig() {
        navigator.clipboard.writeText(
          document.getElementById("desktopConfig").textContent
        );
        showStatus(
          "connectionStatus",
          "Desktop config copied to clipboard!",
          "success"
        );
      }

      // Open banner manager
      function openBannerManager() {
        if (!config.authToken) {
          showStatus(
            "demoStatus",
            "Please configure AUTH_TOKEN first",
            "error"
          );
          return;
        }

        // Update era-config.js with current settings
        saveConfig();
        showStatus(
          "demoStatus",
          "Opening Banner Manager... (Make sure era-config.js is updated)",
          "info"
        );

        // Open in new tab
        window.open("index.html", "_blank");
      }

      // Generate sample banner
      function generateSampleImage() {
        const canvas = document.createElement("canvas");
        canvas.width = 1920;
        canvas.height = 400;
        const ctx = canvas.getContext("2d");

        // Create gradient background
        const gradient = ctx.createLinearGradient(
          0,
          0,
          canvas.width,
          canvas.height
        );
        gradient.addColorStop(0, "#667eea");
        gradient.addColorStop(1, "#764ba2");
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Add text
        ctx.fillStyle = "white";
        ctx.font = "bold 80px Arial";
        ctx.textAlign = "center";
        ctx.fillText(
          "Sample Billboard Banner",
          canvas.width / 2,
          canvas.height / 2 - 40
        );

        ctx.font = "40px Arial";
        ctx.fillText(
          `Generated at ${new Date().toLocaleString()}`,
          canvas.width / 2,
          canvas.height / 2 + 40
        );

        // Download
        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "sample-banner.png";
          a.click();
          URL.revokeObjectURL(url);

          showStatus(
            "demoStatus",
            "Sample banner generated and downloaded!",
            "success"
          );
        });
      }

      // Test MQTT connection
      function testMqttConnection() {
        showStatus(
          "demoStatus",
          "MQTT test not implemented in demo. Use desktop app for full MQTT testing.",
          "info"
        );
      }

      // Utility function to show status
      function showStatus(elementId, message, type) {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="status-box ${type}">${message}</div>`;
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", loadConfig);
    </script>
  </body>
</html>
